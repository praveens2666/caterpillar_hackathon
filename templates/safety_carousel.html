<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <title>Pre-Operation Safety Checklist</title>
    <style>
        body {
            background: #f8fafc;
        }
        #carouselExampleIndicators {
            max-width: 520px;
            margin: 40px auto;
            box-shadow: 0 2px 16px rgba(0,0,0,0.10);
            border-radius: 1.2rem;
            background: #fff;
            padding: 2.5rem 1.5rem 2rem 1.5rem;
        }
        .carousel-inner {
            min-height: 350px;
        }
        .carousel-item {
            text-align: center;
            padding: 1.5rem 0.5rem 0.5rem 0.5rem;
        }
        .checklist-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        h4 {
            font-weight: 600;
            color: #0d6efd;
            margin-bottom: 1.2rem;
        }
        ul.list-unstyled {
            margin-bottom: 1.2rem;
            font-size: 1.08rem;
        }
        .form-check-label {
            font-size: 1.05rem;
        }
        .btn-success {
            font-size: 1.1rem;
            padding: 0.7rem 0;
            border-radius: 0.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .carousel-indicators [data-bs-target] {
            background-color: #0d6efd;
        }
        .carousel-indicators {
            margin-bottom: 0.5rem;
        }
        @media (max-width: 600px) {
            #carouselExampleIndicators {
                padding: 1.2rem 0.2rem 1.2rem 0.2rem;
            }
        }
        .form-check-label{
          color : black;
        }
        body.dark-mode {
            background: #181a1b !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .card, .dark-mode .modal-content, .dark-mode .table {
            background: #23272b !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .table-bordered, .dark-mode .table-bordered th, .dark-mode .table-bordered td {
            border-color: #444 !important;
        }
        .dark-mode .btn, .dark-mode .btn:focus {
            border-color: #444 !important;
        }
        .dark-mode .form-control, .dark-mode .form-select {
            background: #23272b !important;
            color: #e0e0e0 !important;
            border-color: #444 !important;
        }
        .dark-mode .form-control:focus, .dark-mode .form-select:focus {
            background: #23272b !important;
            color: #fff !important;
        }
        .dark-mode .bg-primary, .dark-mode .bg-success, .dark-mode .bg-warning, .dark-mode .bg-info, .dark-mode .bg-danger {
            filter: brightness(0.85);
        }
        .dark-mode .alert-danger, .dark-mode .alert-success, .dark-mode .alert-warning, .dark-mode .alert-info {
            background: #23272b !important;
            color: #e0e0e0 !important;
            border-color: #444 !important;
        }
        .dark-mode .modal-content {
            background: #23272b !important;
        }
        .dark-mode .progress {
            background: #222 !important;
        }
        .dark-mode .progress-bar {
            background: #0d6efd !important;
            color: #fff !important;
        }
        .mx-auto{
          color : black;
        }
        .dark-mode .text-dark { color: #e0e0e0 !important; }
        .dark-mode .text-muted { color: #b0b0b0 !important; }
        .dark-mode .bg-light { background: #23272b !important; }
        .dark-mode .bg-white { background: #23272b !important; }
        .dark-mode .btn-close { filter: invert(1); }
        .theme-toggle {
            position: absolute;
            top: 18px;
            right: 24px;
            z-index: 1000;
        }
    </style>
</head>
<body>
<button class="btn btn-outline-secondary theme-toggle" id="themeToggleBtn" title="Toggle dark/light mode">
    <span id="themeIcon">üåô</span>
</button>
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-interval="false" data-bs-keyboard="false">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4" aria-label="Slide 5"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="5" aria-label="Slide 6"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="6" aria-label="Slide 7"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="7" aria-label="Slide 8"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <div class="checklist-icon">üîç</div>
            <h4>1Ô∏è‚É£ Perform Machine Walkaround Inspection</h4>
            <ul class="list-unstyled text-start mx-auto" style="max-width:400px;">
              <li>‚úÖ Check for leaks</li>
              <li>‚úÖ Inspect tires/tracks</li>
              <li>‚úÖ Test lights & horns</li>
            </ul>
            <div class="form-check">
              <input class="form-check-input confirm-slide" type="checkbox" id="confirm1">
              <label class="form-check-label" for="confirm1">I confirm this step</label>
            </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">ü™ë</div>
            <h4>2Ô∏è‚É£ Seatbelt and Cab Safety</h4>
            <ul class="list-unstyled text-start mx-auto" style="max-width:400px;">
              <li>‚úÖ Seatbelt fastened</li>
              <li>‚úÖ Windows secure</li>
              <li>‚úÖ Fire extinguisher ready</li>
            </ul>
            <div class="form-check">
              <input class="form-check-input confirm-slide" type="checkbox" id="confirm2">
              <label class="form-check-label" for="confirm2">I confirm this step</label>
            </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">üéÆ</div>
              <h4>3Ô∏è‚É£ Check Control Systems</h4>
              <ul class="list-unstyled mx-auto">
                <li>‚úÖ Test all joysticks, pedals, and levers</li>
                <li>‚úÖ Confirm emergency stop works</li>
                <li>‚úÖ Verify backup alarm / camera</li>
              </ul>
              <div class="form-check checklist-confirm">
                <input class="form-check-input confirm-slide" type="checkbox" id="confirm3">
                <label class="form-check-label" for="confirm3">I confirm this step</label>
              </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">üåç</div>
              <h4>4Ô∏è‚É£ Assess Work Area Conditions</h4>
              <ul class="list-unstyled mx-auto">
                <li>‚úÖ Check for people or obstacles in the immediate area</li>
                <li>‚úÖ Identify any overhead hazards (power lines, branches)</li>
                <li>‚úÖ Confirm ground stability</li>
              </ul>
              <div class="form-check checklist-confirm">
                <input class="form-check-input confirm-slide" type="checkbox" id="confirm4">
                <label class="form-check-label" for="confirm4">I confirm this step</label>
              </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">ü¶∫</div>
              <h4>5Ô∏è‚É£ PPE (Personal Protective Equipment) Ready</h4>
              <ul class="list-unstyled mx-auto">
                <li>‚úÖ Helmet, gloves, safety boots, reflective vest</li>
                <li>‚úÖ Eye & ear protection as required</li>
              </ul>
              <div class="form-check checklist-confirm">
                <input class="form-check-input confirm-slide" type="checkbox" id="confirm5">
                <label class="form-check-label" for="confirm5">I confirm this step</label>
              </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">üìã</div>
              <h4>6Ô∏è‚É£ Verify Task and Load Plan</h4>
              <ul class="list-unstyled mx-auto">
                <li>‚úÖ Load limits within machine capacity</li>
                <li>‚úÖ Planned path clear</li>
                <li>‚úÖ Task-specific hazards identified</li>
              </ul>
              <div class="form-check checklist-confirm">
                <input class="form-check-input confirm-slide" type="checkbox" id="confirm6">
                <label class="form-check-label" for="confirm6">I confirm this step</label>
              </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon">üì°</div>
              <h4>7Ô∏è‚É£ Confirm Proximity Devices / Sensors Active</h4>
              <ul class="list-unstyled mx-auto">
                <li>‚úÖ Proximity sensors / collision avoidance systems functional</li>
                <li>‚úÖ Safety alerts tested</li>
              </ul>
              <div class="form-check checklist-confirm">
                <input class="form-check-input confirm-slide" type="checkbox" id="confirm7">
                <label class="form-check-label" for="confirm7">I confirm this step</label>
              </div>
    </div>
    <div class="carousel-item">
      <div class="checklist-icon mx-auto">‚úÖ</div>
              <h4>All Safety Checks Completed</h4>
              <p class="mb-3 mx-auto">By confirming, you acknowledge all safety steps are done.</p>
              <form method="post" id="finalConfirmForm">
                <input type="hidden" name="task_id" value="{{ task_id }}">
                <button type="submit" class="btn btn-success w-100" id="beginTaskBtn" disabled>Begin Task</button>
              </form>
            </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var carousel = document.querySelector('#carouselExampleIndicators');
    var bsCarousel = bootstrap.Carousel.getOrCreateInstance(carousel, {interval: false, keyboard: false, ride: false, pause: true, touch: false});
    // Prevent manual navigation by keyboard or swipe
    carousel.addEventListener('keydown', function(e) { e.preventDefault(); });
    carousel.addEventListener('touchstart', function(e) { e.preventDefault(); });
    // For each checklist step, only allow moving to next after confirm
    var totalSlides = document.querySelectorAll('.carousel-item').length;
    for (let i = 1; i <= totalSlides - 1; i++) {
      let checkbox = document.getElementById('confirm'+i);
      if (checkbox) {
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            setTimeout(function() {
              bsCarousel.next();
            }, 200); // slight delay for UX
          }
        });
      }
    }
    // Disable Begin Task until all steps confirmed
    var beginBtn = document.getElementById('beginTaskBtn');
    var lastCheckbox = document.getElementById('confirm7');
    if (lastCheckbox && beginBtn) {
      lastCheckbox.addEventListener('change', function() {
        if (this.checked) {
          beginBtn.disabled = false;
        } else {
          beginBtn.disabled = true;
        }
      });
    }
    // Prevent form submit if button is disabled
    var finalForm = document.getElementById('finalConfirmForm');
    if (finalForm && beginBtn) {
      finalForm.addEventListener('submit', function(e) {
        if (beginBtn.disabled) {
          e.preventDefault();
        } else {
          // Notify parent to submit the start form
          if (window.parent !== window) {
            window.parent.postMessage('safety_checklist_complete', '*');
          }
          // Prevent default so parent can handle submission
          e.preventDefault();
        }
      });
    }
  });
  (function() {
    const btn = document.getElementById('themeToggleBtn');
    const icon = document.getElementById('themeIcon');
    function setTheme(dark) {
        if (dark) {
            document.body.classList.add('dark-mode');
            icon.textContent = '‚òÄÔ∏è';
            localStorage.setItem('theme', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            icon.textContent = 'üåô';
            localStorage.setItem('theme', 'light');
        }
    }
    btn.addEventListener('click', function() {
        setTheme(!document.body.classList.contains('dark-mode'));
    });
    setTheme(localStorage.getItem('theme') === 'dark');
})();
</script>
</body>
</html>